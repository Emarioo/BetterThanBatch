
#import "BucketArray"

// #import "examples/graphics/game.btb"
// #import "examples/net/serverclient.btb"

#import "Logger"
#import "Lang"
#import "String"

struct Tree {
    name: char[];
    age: i32;
}

arr: BucketArray<Tree>

arr.init(3)

req_elem := arr.requestSpot(5, null)
req_elem.name = "Requested"
req_elem.age = -5

for 0..100 {
    pos, elem := arr.add(null)
    name: StringBuilder
    name.append("oak ")
    name.append(nr)
    elem.name = name.sliced()
    elem.age = nr * 3
}

elem := arr.get(5)
log(elem)

for 0..90 {
    pos := (nr * 120124 + 2131) % arr.getMax()
    // log("del ", pos)
    arr.removeAt(pos)
}


log("items left: ", arr.getCount())

log(&arr)

log("memory: ", arr.getMemoryUsage())

iter := arr.create_iterator()
while arr.iterate(&iter) {
// while arr.iterate_reverse(&iter) {
    log(iter.index," = ",iter.ptr)
}

arr.cleanup()